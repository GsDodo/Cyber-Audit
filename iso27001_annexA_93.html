<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <!-- ‚úÖ Mobile: viewport fit pour la safe-area iOS -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ISO/IEC 27001:2022 ‚Äî Annexe A : 93 contr√¥les (Oui/Non + R√©sultats)</title>
  <meta name="description" content="93 mesures ISO/IEC 27001:2022 (Annexe A) par cat√©gorie, cases Oui/Non, sauvegarde locale, page de r√©sultats et export CSV.">

  <!-- ‚úÖ PATCH mobile (meta) -->
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="theme-color" media="(prefers-color-scheme: dark)"  content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    :root{ --bg:#0b1220; --panel:#0f172a; --card:#0f172a; --text:#e2e8f0; --muted:#94a3b8; --brand:#5b8def; --accent:#22c55e; --warn:#f59e0b; --danger:#ef4444; --line:#1f2937; --shadow:0 10px 28px rgba(2,6,23,.24); }
    [data-theme="light"]{ --bg:#ffffff; --panel:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#475569; --brand:#3b82f6; --accent:#059669; --warn:#d97706; --danger:#b91c1c; --line:#e5e7eb; --shadow:0 8px 20px rgba(15,23,42,.08); }

    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:0 20px}

    header{border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(16,24,40,.25), rgba(16,24,40,0))}
    .bar{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 0}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted);font-size:13px;margin:4px 0 0 0}

    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:14px 0}
    .btn{border:1px solid var(--line);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
    .btn--brand{background:var(--brand);border-color:transparent;color:#fff}

    .stat{display:inline-block;border:1px solid var(--line);border-radius:10px;padding:6px 10px;background:var(--panel);font-size:13px;color:var(--muted)}
    .stat b{color:var(--text)}

    .group{border:1px solid var(--line);border-radius:14px;background:var(--card);box-shadow:var(--shadow);margin:16px 0}
    .group header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .group h2{margin:0;font-size:18px}
    .tag{display:inline-block;border-radius:999px;padding:4px 10px;background:rgba(91,141,239,.12);color:var(--brand);font-size:12px;margin-left:10px}

    .controls{padding:6px 16px 16px}
    .controls details{border:1px solid var(--line);border-radius:10px;margin:10px 0;background:var(--panel)}
    .controls summary{cursor:pointer;padding:10px 12px;font-weight:600}
    .controls ol{margin:6px 0 14px 28px}
    .controls li{margin:8px 0;display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}
    .ref{min-width:64px;color:var(--muted);font-weight:700}
    .label{flex:1}
    .yn{display:inline-flex;gap:10px;align-items:center}
    .yn label{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer;background:var(--panel);font-size:13px}
    .yn input{accent-color:var(--brand)}
    footer{border-top:1px solid var(--line);margin-top:24px}
    .foot{padding:12px 0;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px}

    @media print {.toolbar{display:none} details{open:true}}

    /* === PATCH mobile CSS ‚Äî AUCUNE FONCTION JS MODIFI√âE === */
    :root{ --radius:14px; --tap:44px; }
    body { -webkit-text-size-adjust:100%; }
    :focus-visible{ outline:2px solid var(--brand); outline-offset:2px; }

    /* Confort tactile et lisibilit√© */
    .btn, .toolbar .btn, .yn label { min-height: var(--tap); }
    .yn input { width:18px; height:18px; }                 /* tailles radio lisibles */
    .yn label { padding:8px 12px; }                        /* coussin tactile */
    .controls li { grid-template-columns:minmax(52px,auto) 1fr auto; } /* mieux g√©rer le ref */

    /* Typo fluide */
    h1{ font-size: clamp(20px, 2.9vw, 22px); }
    .muted{ font-size: clamp(13px, 3vw, 13px); }

    /* iOS : retirer le flash bleu au toucher */
    a, button, label { -webkit-tap-highlight-color: rgba(0,0,0,0); }

    /* Tablette et < 1100px : marges plus souples */
    @media (max-width: 768px){
      .wrap{ padding:0 16px }
      .group{ border-radius:var(--radius) }
      .controls ol{ margin-left:20px }
    }

    /* T√©l√©phones √©troits */
    @media (max-width: 480px){
      .bar{ flex-direction:column; gap:10px; align-items:flex-start }
      .toolbar .btn { flex:1 1 auto; }                     /* peut s'√©taler si besoin */
      .controls summary { padding:12px 12px; }
      .controls li { gap:12px; }
      .label { line-height:1.5; }                          /* multi-ligne confortable */
      .yn { gap:12px; }
    }

    /* Safe-area iOS (notch) */
    header .bar, footer .foot{
      padding-left:max(20px, env(safe-area-inset-left));
      padding-right:max(20px, env(safe-area-inset-right));
    }

    /* Accessibilit√© motion r√©duite */
    @media (prefers-reduced-motion:reduce){
      *{ scroll-behavior:auto }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <div>
        <h1>ISO/IEC 27001:2022 ‚Äì Annexe A : 93 contr√¥les (√©valuation Oui/Non)</h1>
        <p class="muted">Les intitul√©s sont synth√©tiques (p√©dagogie). Les choix sont sauvegard√©s localement.</p>
      </div>
      <div class="stat">Global&nbsp;: <b id="g-yes">0</b> Oui ‚Ä¢ <b id="g-no">0</b> Non ‚Ä¢ <b id="g-na">93</b> Non r√©pondu</div>
    </div>
  </header>

  <main class="wrap">
    <div class="toolbar">
      <button id="btn-report" class="btn btn--brand">üßæ G√©n√©rer la page de r√©sultats</button>
      <button id="btn-csv" class="btn">‚¨áÔ∏è Exporter CSV</button>
      <button id="btn-reset" class="btn">‚ôªÔ∏è R√©initialiser</button>
    </div>

    <section class="group">
      <header><h2>Infos</h2></header>
      <div class="controls"><div class="muted">Cette page couvre les 4 cat√©gories : 5.x Organisationnels (37), 6.x Personnes (8), 7.x Physiques (14), 8.x Technologiques (34).</div></div>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <div>¬© <span id="y"></span> √âvaluation ISO/IEC&nbsp;27001:2022 (Annexe A)</div>
      <div id="score"></div>
    </div>
  </footer>

  <!-- ‚úÖ TOUTES TES FONCTIONS RESTENT STRICTEMENT IDENTIQUES -->
  <script>
    const LS_PREFIX = 'iso27001-2022-ctrl-';
    const ORG = [['5.1','Politiques de s√©curit√© de l‚Äôinformation'],['5.2','R√¥les et responsabilit√©s SSI'],['5.3','S√©gr√©gation des t√¢ches'],['5.4','Responsabilit√©s de la direction'],['5.5','Contacts avec les autorit√©s'],['5.6','Contacts avec les groupes d‚Äôint√©r√™t'],['5.7','Renseignement sur les menaces'],['5.8','SSI dans la gestion de projet'],['5.9','Inventaire des informations et actifs associ√©s'],['5.10','Usage acceptable de l‚Äôinformation et des actifs'],['5.11','Restitution des actifs'],['5.12','Classification de l‚Äôinformation'],['5.13','√âtiquetage de l‚Äôinformation'],['5.14','Transfert d‚Äôinformations'],['5.15','Contr√¥le d‚Äôacc√®s (principes)'],['5.16','Gestion des identit√©s'],['5.17','Informations d‚Äôauthentification'],['5.18','Droits d‚Äôacc√®s'],['5.19','SSI dans les relations fournisseurs'],['5.20','SSI dans les contrats fournisseurs'],['5.21','SSI dans la cha√Æne d‚Äôapprovisionnement TIC'],['5.22','Suivi/revue/changements des services fournisseurs'],['5.23','SSI pour l‚Äôusage des services cloud'],['5.24','Planification & pr√©paration (gestion des incidents)'],['5.25','√âvaluation & d√©cision sur les √©v√©nements'],['5.26','R√©ponse aux incidents'],['5.27','Retour d‚Äôexp√©rience apr√®s incident'],['5.28','Collecte de preuves'],['5.29','SSI lors des perturbations'],['5.30','Pr√©paration TIC √† la continuit√© d‚Äôactivit√©'],['5.31','Exigences l√©gales/r√©glementaires/contractuelles'],['5.32','Droits de propri√©t√© intellectuelle'],['5.33','Protection des enregistrements'],['5.34','Vie priv√©e & PII'],['5.35','Revue ind√©pendante de la SSI'],['5.36','Conformit√© aux politiques/r√®gles/standards'],['5.37','Proc√©dures op√©ratoires document√©es']];
    const PEOPLE = [['6.1','V√©rifications pr√©‚Äëemploi (screening)'],['6.2','Conditions d‚Äôemploi'],['6.3','Sensibilisation / √©ducation / formation SSI'],['6.4','Processus disciplinaire'],['6.5','Responsabilit√©s post‚Äëemploi / changement'],['6.6','Confidentialit√© (NDA)'],['6.7','Travail √† distance'],['6.8','Signalement des √©v√©nements SSI']];
    const PHYS = [['7.1','P√©rim√®tres de s√©curit√© physique'],['7.2','Contr√¥les d‚Äôacc√®s physique'],['7.3','S√©curisation des bureaux/salles/locaux'],['7.4','Surveillance de la s√©curit√© physique'],['7.5','Menaces physiques & environnementales'],['7.6','Travail en zones s√©curis√©es'],['7.7','Bureau clair / √©cran clair'],['7.8','Emplacement & protection des √©quipements'],['7.9','S√©curit√© des actifs hors site'],['7.10','Supports de stockage'],['7.11','Services utilitaires (√©nergie, clim, etc.)'],['7.12','S√©curit√© du c√¢blage'],['7.13','Maintenance des √©quipements'],['7.14','√âlimination / r√©utilisation des √©quipements']];
    const TECH = [['8.1','Dispositifs utilisateur (endpoints)'],['8.2','S√©curit√© des donn√©es en transmission'],['8.3','Filtrage du trafic r√©seau'],['8.4','Services r√©seau s√©curis√©s'],['8.5','S√©curit√© des plateformes / environnements'],['8.6','Capacit√© & performance'],['8.7','Protection antimalware'],['8.8','Gestion des vuln√©rabilit√©s (tech)'],['8.9','Gestion de la configuration'],['8.10','Suppression des informations'],['8.11','Masquage des donn√©es'],['8.12','Pr√©vention de fuites (DLP)'],['8.13','Sauvegardes'],['8.14','Journalisation'],['8.15','Synchronisation de l‚Äôhorloge'],['8.16','Activit√©s de surveillance (monitoring)'],['8.17','D√©tection de maliciels'],['8.18','Gestion des vuln√©rabilit√©s (process)'],['8.19','Authentification s√©curis√©e'],['8.20','Gestion des infos d‚Äôauthentification'],['8.21','Restrictions utilitaires syst√®mes'],['8.22','S√©curit√© des environnements de dev'],['8.23','Filtrage Web'],['8.24','Code mobile / macros'],['8.25','Vuln√©rabilit√©s applicatives'],['8.26','S√©curit√© du d√©veloppement (SDLC)'],['8.27','Tests de s√©curit√© applicative'],['8.28','Codage s√©curis√©'],['8.29','Services infog√©r√©s/externes ‚Äî s√©curit√©'],['8.30','Contr√¥le des d√©ploiements & changements'],['8.31','S√©curit√© des API & interfaces'],['8.32','Durcissement plateformes/syst√®mes'],['8.33','R√©silience & capacit√© (tech)'],['8.34','Protection anti‚ÄëDoS']];

    const GROUPS = [
      {id:'org', label:'Organisationnels (5.x)', total:37, data:ORG},
      {id:'people', label:'Personnes (6.x)', total:8, data:PEOPLE},
      {id:'physical', label:'Physiques (7.x)', total:14, data:PHYS},
      {id:'tech', label:'Technologiques (8.x)', total:34, data:TECH},
    ];

    function renderGroups(){
      const main=document.querySelector('main.wrap'); const sources=document.querySelector('section.group:last-of-type');
      GROUPS.forEach(g=>{
        const sec=document.createElement('section'); sec.className='group'; sec.id=g.id;
        sec.innerHTML=`<header><h2>${g.label} <span class="tag">${g.total}</span></h2></header><div class="controls" data-group="${g.id}"><details open data-default-open><summary>Contr√¥les ${g.label.split('(')[0].trim()} (${g.total})</summary><ol></ol></details></div>`;
        const ol=sec.querySelector('ol');
        g.data.forEach(([ref,label])=>{
          const li=document.createElement('li'); li.dataset.ref=ref; li.dataset.text=label; li.dataset.group=g.id;
          li.innerHTML=`<span class="ref">${ref}</span><span class="label">${label}</span><span class="yn"><label title="Oui"><input type="radio" name="ctrl-${ref}" value="oui"> Oui</label><label title="Non"><input type="radio" name="ctrl-${ref}" value="non"> Non</label></span>`;
          const saved=localStorage.getItem(LS_PREFIX+ref); if(saved){ const inp=li.querySelector(`input[value="${saved}"]`); if(inp) inp.checked=true; }
          li.querySelectorAll(`input[name="ctrl-${ref}"]`).forEach(inp=> inp.addEventListener('change', ()=>{ localStorage.setItem(LS_PREFIX+ref, inp.value); updateStats(); }));
          ol.appendChild(li);
        });
        main.insertBefore(sec, sources);
      });
    }

    function computeStats(){
      const groups={ org:{yes:0,no:0,tot:37}, people:{yes:0,no:0,tot:8}, physical:{yes:0,no:0,tot:14}, tech:{yes:0,no:0,tot:34} };
      const details=[];
      document.querySelectorAll('.controls').forEach(sec=>{
        const cat=sec.dataset.group;
        sec.querySelectorAll('li').forEach(li=>{
          const ref=li.dataset.ref, text=li.dataset.text; 
          const val = li.querySelector('input:checked')?.value || 'na';
          if(val==='oui') groups[cat].yes++; else if(val==='non') groups[cat].no++;
          details.push({ref,text,cat,val});
        });
      });
      const yes=Object.values(groups).reduce((a,g)=>a+g.yes,0);
      const no =Object.values(groups).reduce((a,g)=>a+g.no,0);
      const total=93; const na=total-yes-no;
      return {groups, details, global:{yes,no,na,total}};
    }

    function updateStats(){
      const s=computeStats();
      document.getElementById('g-yes').textContent=s.global.yes; 
      document.getElementById('g-no').textContent =s.global.no; 
      document.getElementById('g-na').textContent =s.global.na;
      const pct=Math.round((s.global.yes/s.global.total)*100); 
      document.getElementById('score').textContent=`Conformit√© (Oui) : ${pct}% (${s.global.yes}/${s.global.total})`;
      try{
        if(window.parent && window.parent!==window){
          window.parent.postMessage({type:'UCAP_SUMMARY', norm:'ISO27001', data:{ yes:s.global.yes, no:s.global.no, na:s.global.na, total:s.global.total, pct:pct }}, '*');
        }
      }catch(e){}
    }

    // Rapport (PDF) ‚Äî d√©j√† robuste
    function generateReport(){
      const s=computeStats(), now=new Date();
      const d=now.toLocaleString('fr-FR');
      const fileSafeDate = now.toISOString().slice(0,19).replace(/[:T]/g,'-');
      const reportTitle = `CyberAudit - R√©sultats ISO27001 - ${fileSafeDate}`;

      const cats=[{id:'org',label:'Organisationnels (5.x)'},{id:'people',label:'Personnes (6.x)'},{id:'physical',label:'Physiques (7.x)'},{id:'tech',label:'Technologiques (8.x)'}];
      const by=(id)=> s.details.filter(x=>x.cat===id);
      const list=(arr,val)=> arr.filter(x=>x.val===val).sort((a,b)=> a.ref.localeCompare(b.ref));

      let html='<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">';
      html+=`<title>${reportTitle}</title>`;
      html+=`<style>
        :root{--ink:#0f172a;--muted:#64748b;--band:#f3f4f6}
        body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px;line-height:1.55;color:var(--ink);-webkit-print-color-adjust:exact;print-color-adjust:exact}
        h1{font-size:22px;margin:0 0 6px} h2{margin:16px 0 8px} h3{margin:12px 0 6px}
        small{color:var(--muted)} .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e40af;font-weight:700}
        table{border-collapse:collapse;width:100%;margin:8px 0} th,td{border:1px solid #e5e7eb;padding:8px;text-align:left;font-size:14px}
        tr:nth-child(even){background:var(--band)} .noprint{margin:6px 0 10px} .page-break{break-after:page}
        @page{size:A4;margin:14mm} @media print {.noprint{display:none}}
      </style></head><body>`;

      html+=`<h1>R√©sultats ‚Äî ISO/IEC 27001:2022 (Annexe A)</h1>
             <div class="noprint"><small>G√©n√©r√© le ${d}</small> ‚Äî <button onclick="window.print()">T√©l√©charger en PDF</button></div>`;

      html+=`<h2>R√©sum√© global</h2>
             <table><tr><th>Total</th><th>Oui</th><th>Non</th><th>Non r√©pondu</th><th>Conformit√© (Oui)</th></tr>
             <tr><td>${s.global.total}</td><td>${s.global.yes}</td><td>${s.global.no}</td><td>${s.global.na}</td><td>${Math.round((s.global.yes/s.global.total)*100)}%</td></tr></table>`;

      html+=`<h2>D√©tail par cat√©gorie</h2>
             <table><tr><th>Cat√©gorie</th><th>Oui</th><th>Non</th><th>Non r√©pondu</th><th>Total</th></tr>
             <tr><td>Organisationnels (5.x)</td><td>${s.groups.org.yes}</td><td>${s.groups.org.no}</td><td>${37-s.groups.org.yes-s.groups.org.no}</td><td>37</td></tr>
             <tr><td>Personnes (6.x)</td><td>${s.groups.people.yes}</td><td>${s.groups.people.no}</td><td>${8-s.groups.people.yes-s.groups.people.no}</td><td>8</td></tr>
             <tr><td>Physiques (7.x)</td><td>${s.groups.physical.yes}</td><td>${s.groups.physical.no}</td><td>${14-s.groups.physical.yes-s.groups.physical.no}</td><td>14</td></tr>
             <tr><td>Technologiques (8.x)</td><td>${s.groups.tech.yes}</td><td>${s.groups.tech.no}</td><td>${34-s.groups.tech.yes-s.groups.tech.no}</td><td>34</td></tr></table>`;

      html+=`<div class="page-break"></div><h2>Contr√¥les ‚ÄúNon‚Äù (√† traiter)</h2>`;
      cats.forEach(c=>{
        const arr=list(by(c.id),'non');
        html+=`<h3>${c.label} ‚Äî <span class="badge">${arr.length}</span></h3>`;
        if(arr.length===0){ html+='<div><small>Aucun.</small></div>'; }
        else{ html+='<table><tr><th>R√©f.</th><th>Intitul√©</th></tr>'; arr.forEach(x=> html+=`<tr><td>${x.ref}</td><td>${x.text}</td></tr>`); html+='</table>'; }
      });

      html+=`<div class="page-break"></div><h2>Contr√¥les ‚ÄúNon r√©pondu‚Äù (√† compl√©ter)</h2>`;
      cats.forEach(c=>{
        const arr=list(by(c.id),'na');
        html+=`<h3>${c.label} ‚Äî <span class="badge">${arr.length}</span></h3>`;
        if(arr.length===0){ html+='<div><small>Complet.</small></div>'; }
        else{ html+='<table><tr><th>R√©f.</th><th>Intitul√©</th></tr>'; arr.forEach(x=> html+=`<tr><td>${x.ref}</td><td>${x.text}</td></tr>`); html+='</table>'; }
      });

      html+=`<script>
        document.title = ${JSON.stringify(reportTitle)};
        window.addEventListener('load', () => { setTimeout(() => { try{ window.print(); }catch(e){} }, 250); });
        window.addEventListener('afterprint', () => { try{ window.close(); }catch(e){} });
      <\/script></body></html>`;

      const win = window.open('about:blank','_blank','noopener,noreferrer');
      if(!win){ const dataUrl='data:text/html;charset=utf-8,'+encodeURIComponent(html); window.location.href=dataUrl; return; }
      win.document.open(); win.document.write(html); win.document.close(); try{ win.focus(); }catch(e){}
    }

    // CSV (BOM + Safari/iOS)
    function exportCSV(){
      const {details}=computeStats();
      const rows=[["Ref","Cat√©gorie","Intitul√©","R√©ponse"]];
      const map={org:'Organisationnels (5.x)',people:'Personnes (6.x)',physical:'Physiques (7.x)',tech:'Technologiques (8.x)'};
      details.forEach(d=> rows.push([d.ref, map[d.cat], d.text, d.val]));
      const csvBody = rows.map(r => r.map(x => '"'+(x||'').replace(/"/g,'""')+'"').join(';')).join('\n');
      const BOM = '\uFEFF';
      const blob=new Blob([BOM + csvBody],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='etat_iso27001_annexA.csv';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 2000);
    }

    function resetAll(){
      if(!confirm('Supprimer toutes les r√©ponses enregistr√©es ?')) return;
      document.querySelectorAll('.controls li').forEach(li=>{
        const ref=li.dataset.ref;
        localStorage.removeItem(LS_PREFIX+ref);
        li.querySelectorAll('input[type="radio"]').forEach(i=>{ i.checked=false; });
      });
      updateStats();
    }

    // Init fiable (mobile/iframe)
    window.addEventListener('DOMContentLoaded', () => {
      renderGroups();
      updateStats();
      document.getElementById('btn-report')?.addEventListener('click', generateReport);
      document.getElementById('btn-csv')?.addEventListener('click', exportCSV);
      document.getElementById('btn-reset')?.addEventListener('click', resetAll);
      document.getElementById('y').textContent=new Date().getFullYear();
    });
  </script>
</body>
</html>
