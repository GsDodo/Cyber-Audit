<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ISO/IEC 27001:2022 ‚Äî Annexe A : 93 contr√¥les (Oui/Non + Rapport)</title>
  <meta name="description" content="Liste interactive des 93 contr√¥les ISO/IEC 27001:2022 (Annexe A), cases Oui/Non, enregistrement local, rapport d‚Äôaudit et export CSV.">
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --card:#0f172a; --text:#e2e8f0; --muted:#94a3b8;
      --brand:#5b8def; --accent:#22c55e; --warn:#f59e0b; --danger:#ef4444; --line:#1f2937; --shadow:0 10px 28px rgba(2,6,23,.24);
    }
    [data-theme="light"]{
      --bg:#ffffff; --panel:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#475569;
      --brand:#3b82f6; --accent:#059669; --warn:#d97706; --danger:#b91c1c; --line:#e5e7eb; --shadow:0 8px 20px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:0 20px}

    header{border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(16,24,40,.25), rgba(16,24,40,0))}
    .bar{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 0}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted);font-size:13px;margin:4px 0 0 0}

    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:14px 0}
    .btn{border:1px solid var(--line);background:var(--panel);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
    .btn--brand{background:var(--brand);border-color:transparent;color:#fff}
    .stat{display:inline-block;border:1px solid var(--line);border-radius:10px;padding:6px 10px;background:var(--panel);font-size:13px;color:var(--muted)}
    .stat b{color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
    .info{font-size:12px;color:var(--muted)}

    .group{border:1px solid var(--line);border-radius:14px;background:var(--card);box-shadow:var(--shadow);margin:16px 0}
    .group header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .group h2{margin:0;font-size:18px}
    .tag{display:inline-block;border-radius:999px;padding:4px 10px;background:rgba(91,141,239,.12);color:var(--brand);font-size:12px;margin-left:10px}
    .controls{padding:6px 16px 16px}
    .controls details{border:1px solid var(--line);border-radius:10px;margin:10px 0;background:var(--panel)}
    .controls summary{cursor:pointer;padding:10px 12px;font-weight:600}
    .controls ol{margin:6px 0 14px 28px}
    .controls li{margin:6px 0;display:flex;align-items:flex-start;gap:10px}
    .ref{min-width:64px;color:var(--muted);font-weight:700}
    .label{flex:1}

    /* Toggle Oui/Non compact */
    .yn{display:inline-flex;gap:10px;align-items:center;margin-left:auto}
    .yn label{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid var(--line);border-radius:999px;cursor:pointer;background:var(--panel);font-size:13px}
    .yn input{accent-color:var(--brand);}

    footer{border-top:1px solid var(--line);margin-top:24px}
    .foot{padding:12px 0;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px}

    /* Impression (rapport) */
    @media print {
      .toolbar{display:none}
      details{open:true}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <div>
        <h1>ISO/IEC 27001:2022 ‚Äì Annexe A : 93 contr√¥les (√©valuation Oui/Non)</h1>
        <p class="muted">Titres non officiels/paraphras√©s pour usage p√©dagogique. Les r√©ponses sont enregistr√©es dans votre navigateur (localStorage).</p>
      </div>
      <div class="grid" style="max-width:520px">
        <span class="stat">Global¬†: <b id="g-yes">0</b> Oui ‚Ä¢ <b id="g-no">0</b> Non ‚Ä¢ <b id="g-na">93</b> Non r√©pondu</span>
        <span class="stat">Org¬†<b id="o-yes">0</b>/<b>37</b> ‚Ä¢ People¬†<b id="p-yes">0</b>/<b>8</b> ‚Ä¢ Phys¬†<b id="ph-yes">0</b>/<b>14</b> ‚Ä¢ Tech¬†<b id="t-yes">0</b>/<b>34</b></span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="toolbar">
      <button id="btn-report" class="btn btn--brand">üßæ G√©n√©rer le rapport</button>
      <button id="btn-csv" class="btn">‚¨áÔ∏è Exporter CSV</button>
      <button id="btn-reset" class="btn">‚ôªÔ∏è R√©initialiser</button>
      <span class="info">Conseil¬†: r√©pondez √† tout (Oui/Non), vous pourrez compl√©ter les preuves dans votre rapport principal.</span>
    </div>

    <!-- ====== ORGANISATIONNEL ====== -->
    <section id="org" class="group">
      <header>
        <h2>Contr√¥les organisationnels <span class="tag">37</span></h2>
      </header>
      <div class="controls" data-group="org">
        <details open data-default-open><summary>Gouvernance & politique</summary>
          <ol>
            <li><span class="ref">5.1</span><span class="label">Politiques de s√©curit√© de l‚Äôinformation</span></li>
            <li><span class="ref">5.2</span><span class="label">R√¥les et responsabilit√©s SSI</span></li>
            <li><span class="ref">5.3</span><span class="label">S√©gr√©gation des t√¢ches</span></li>
            <li><span class="ref">5.4</span><span class="label">Responsabilit√©s de la direction</span></li>
            <li><span class="ref">5.5</span><span class="label">Contacts avec les autorit√©s</span></li>
            <li><span class="ref">5.6</span><span class="label">Contacts avec les groupes d‚Äôint√©r√™t</span></li>
            <li><span class="ref">5.7</span><span class="label">Renseignement sur les menaces</span></li>
            <li><span class="ref">5.8</span><span class="label">SSI dans la gestion de projet</span></li>
          </ol>
        </details>
        <details><summary>Gestion des actifs & informations</summary>
          <ol start="9">
            <li><span class="ref">5.9</span><span class="label">Inventaire des informations et actifs associ√©s</span></li>
            <li><span class="ref">5.10</span><span class="label">Usage acceptable de l‚Äôinformation et des actifs</span></li>
            <li><span class="ref">5.11</span><span class="label">Restitution des actifs</span></li>
            <li><span class="ref">5.12</span><span class="label">Classification de l‚Äôinformation</span></li>
            <li><span class="ref">5.13</span><span class="label">√âtiquetage de l‚Äôinformation</span></li>
            <li><span class="ref">5.14</span><span class="label">Transfert d‚Äôinformations</span></li>
          </ol>
        </details>
        <details><summary>Acc√®s & identit√©s (cadre orga)</summary>
          <ol start="15">
            <li><span class="ref">5.15</span><span class="label">Contr√¥le d‚Äôacc√®s (principes)</span></li>
            <li><span class="ref">5.16</span><span class="label">Gestion des identit√©s</span></li>
            <li><span class="ref">5.17</span><span class="label">Informations d‚Äôauthentification</span></li>
            <li><span class="ref">5.18</span><span class="label">Droits d‚Äôacc√®s</span></li>
          </ol>
        </details>
        <details><summary>Fournisseurs & cha√Æne d‚Äôapprovisionnement</summary>
          <ol start="19">
            <li><span class="ref">5.19</span><span class="label">SSI dans les relations fournisseurs</span></li>
            <li><span class="ref">5.20</span><span class="label">SSI dans les contrats fournisseurs</span></li>
            <li><span class="ref">5.21</span><span class="label">SSI dans la cha√Æne d‚Äôapprovisionnement TIC</span></li>
            <li><span class="ref">5.22</span><span class="label">Suivi/revue/changements des services fournisseurs</span></li>
            <li><span class="ref">5.23</span><span class="label">SSI pour l‚Äôusage des services cloud</span></li>
          </ol>
        </details>
        <details><summary>Incidents & continuit√©</summary>
          <ol start="24">
            <li><span class="ref">5.24</span><span class="label">Planification & pr√©paration (gestion des incidents)</span></li>
            <li><span class="ref">5.25</span><span class="label">√âvaluation & d√©cision sur les √©v√©nements</span></li>
            <li><span class="ref">5.26</span><span class="label">R√©ponse aux incidents</span></li>
            <li><span class="ref">5.27</span><span class="label">Retour d‚Äôexp√©rience (post‚Äëincident)</span></li>
            <li><span class="ref">5.28</span><span class="label">Collecte de preuves</span></li>
            <li><span class="ref">5.29</span><span class="label">SSI lors des perturbations</span></li>
            <li><span class="ref">5.30</span><span class="label">Pr√©paration TIC √† la continuit√© d‚Äôactivit√©</span></li>
          </ol>
        </details>
        <details><summary>Conformit√© & exigences</summary>
          <ol start="31">
            <li><span class="ref">5.31</span><span class="label">Exigences l√©gales/r√©glementaires/contractuelles</span></li>
            <li><span class="ref">5.32</span><span class="label">Propri√©t√© intellectuelle</span></li>
            <li><span class="ref">5.33</span><span class="label">Protection des enregistrements</span></li>
            <li><span class="ref">5.34</span><span class="label">Vie priv√©e & PII</span></li>
            <li><span class="ref">5.35</span><span class="label">Revue ind√©pendante de la SSI</span></li>
            <li><span class="ref">5.36</span><span class="label">Conformit√© aux politiques/r√®gles/standards</span></li>
            <li><span class="ref">5.37</span><span class="label">Proc√©dures op√©ratoires document√©es</span></li>
          </ol>
        </details>
      </div>
    </section>

    <!-- ====== PERSONNES ====== -->
    <section id="people" class="group">
      <header>
        <h2>Contr√¥les li√©s aux personnes <span class="tag">8</span></h2>
      </header>
      <div class="controls" data-group="people">
        <details open data-default-open><summary>Ressources humaines & sensibilisation</summary>
          <ol>
            <li><span class="ref">6.1</span><span class="label">V√©rifications pr√©‚Äëemploi (screening)</span></li>
            <li><span class="ref">6.2</span><span class="label">Conditions d‚Äôemploi</span></li>
            <li><span class="ref">6.3</span><span class="label">Sensibilisation / √©ducation / formation SSI</span></li>
            <li><span class="ref">6.4</span><span class="label">Processus disciplinaire</span></li>
            <li><span class="ref">6.5</span><span class="label">Responsabilit√©s apr√®s d√©part/changement</span></li>
            <li><span class="ref">6.6</span><span class="label">Confidentialit√© (NDA)</span></li>
            <li><span class="ref">6.7</span><span class="label">Travail √† distance</span></li>
            <li><span class="ref">6.8</span><span class="label">Signalement des √©v√©nements SSI</span></li>
          </ol>
        </details>
      </div>
    </section>

    <!-- ====== PHYSIQUE ====== -->
    <section id="physical" class="group">
      <header>
        <h2>Contr√¥les physiques <span class="tag">14</span></h2>
      </header>
      <div class="controls" data-group="physical">
        <details open data-default-open><summary>Sites, acc√®s & environnements</summary>
          <ol>
            <li><span class="ref">7.1</span><span class="label">P√©rim√®tres de s√©curit√© physique</span></li>
            <li><span class="ref">7.2</span><span class="label">Contr√¥les d‚Äôacc√®s physique</span></li>
            <li><span class="ref">7.3</span><span class="label">S√©curisation des bureaux / salles / locaux</span></li>
            <li><span class="ref">7.4</span><span class="label">Surveillance de la s√©curit√© physique</span></li>
            <li><span class="ref">7.5</span><span class="label">Menaces physiques & environnementales</span></li>
            <li><span class="ref">7.6</span><span class="label">Travail en zones s√©curis√©es</span></li>
            <li><span class="ref">7.7</span><span class="label">Bureau clair / √©cran clair</span></li>
            <li><span class="ref">7.8</span><span class="label">Emplacement & protection des √©quipements</span></li>
            <li><span class="ref">7.9</span><span class="label">S√©curit√© des actifs hors site</span></li>
            <li><span class="ref">7.10</span><span class="label">Supports de stockage</span></li>
            <li><span class="ref">7.11</span><span class="label">Services utilitaires</span></li>
            <li><span class="ref">7.12</span><span class="label">S√©curit√© du c√¢blage</span></li>
            <li><span class="ref">7.13</span><span class="label">Maintenance des √©quipements</span></li>
            <li><span class="ref">7.14</span><span class="label">√âlimination / r√©utilisation s√©curis√©e des √©quipements</span></li>
          </ol>
        </details>
      </div>
    </section>

    <!-- ====== TECHNOLOGIQUE ====== -->
    <section id="tech" class="group">
      <header>
        <h2>Contr√¥les technologiques <span class="tag">34</span></h2>
      </header>
      <div class="controls" data-group="tech">
        <details open data-default-open><summary>Postes, donn√©es & r√©seau</summary>
          <ol>
            <li><span class="ref">8.1</span><span class="label">Dispositifs utilisateur</span></li>
            <li><span class="ref">8.2</span><span class="label">S√©curit√© des donn√©es en transmission</span></li>
            <li><span class="ref">8.3</span><span class="label">Filtrage du trafic r√©seau</span></li>
            <li><span class="ref">8.4</span><span class="label">Services r√©seau s√©curis√©s</span></li>
            <li><span class="ref">8.5</span><span class="label">S√©curit√© des plateformes & environnements</span></li>
            <li><span class="ref">8.6</span><span class="label">Capacit√© & performance</span></li>
            <li><span class="ref">8.7</span><span class="label">Protection antimalware</span></li>
            <li><span class="ref">8.8</span><span class="label">Gestion des vuln√©rabilit√©s techniques</span></li>
            <li><span class="ref">8.9</span><span class="label">Gestion de la configuration</span></li>
            <li><span class="ref">8.10</span><span class="label">Suppression des informations</span></li>
            <li><span class="ref">8.11</span><span class="label">Masquage des donn√©es</span></li>
            <li><span class="ref">8.12</span><span class="label">Pr√©vention de fuites de donn√©es (DLP)</span></li>
          </ol>
        </details>
        <details><summary>Journalisation, surveillance & sauvegardes</summary>
          <ol start="13">
            <li><span class="ref">8.13</span><span class="label">Sauvegardes</span></li>
            <li><span class="ref">8.14</span><span class="label">Journalisation</span></li>
            <li><span class="ref">8.15</span><span class="label">Synchronisation de l‚Äôhorloge</span></li>
            <li><span class="ref">8.16</span><span class="label">Activit√©s de surveillance</span></li>
            <li><span class="ref">8.17</span><span class="label">D√©tection de logiciels malveillants</span></li>
            <li><span class="ref">8.18</span><span class="label">Gestion des vuln√©rabilit√©s (tech)</span></li>
          </ol>
        </details>
        <details><summary>Acc√®s techniques & environnements</summary>
          <ol start="19">
            <li><span class="ref">8.19</span><span class="label">Authentification s√©curis√©e</span></li>
            <li><span class="ref">8.20</span><span class="label">Gestion des infos d‚Äôauthentification</span></li>
            <li><span class="ref">8.21</span><span class="label">Restrictions sur utilitaires syst√®mes</span></li>
            <li><span class="ref">8.22</span><span class="label">S√©curit√© des environnements de dev</span></li>
            <li><span class="ref">8.23</span><span class="label">Filtrage Web</span></li>
            <li><span class="ref">8.24</span><span class="label">Code mobile / macros</span></li>
          </ol>
        </details>
        <details><summary>Cycle de vie & applicatif</summary>
          <ol start="25">
            <li><span class="ref">8.25</span><span class="label">Vuln√©rabilit√©s applicatives</span></li>
            <li><span class="ref">8.26</span><span class="label">S√©curit√© du d√©veloppement (SDLC)</span></li>
            <li><span class="ref">8.27</span><span class="label">Tests de s√©curit√© applicative</span></li>
            <li><span class="ref">8.28</span><span class="label">Codage s√©curis√©</span></li>
          </ol>
        </details>
        <details><summary>Services & op√©rations</summary>
          <ol start="29">
            <li><span class="ref">8.29</span><span class="label">Services infog√©r√©s/externes ‚Äî s√©curit√©</span></li>
            <li><span class="ref">8.30</span><span class="label">Contr√¥le des d√©ploiements & changements</span></li>
            <li><span class="ref">8.31</span><span class="label">S√©curit√© des API & interfaces</span></li>
            <li><span class="ref">8.32</span><span class="label">Durcissement plateformes/syst√®mes</span></li>
            <li><span class="ref">8.33</span><span class="label">R√©silience & capacit√© (tech)</span></li>
            <li><span class="ref">8.34</span><span class="label">Protection anti‚ÄëDoS</span></li>
          </ol>
        </details>
      </div>
    </section>

    <section class="group">
      <header><h2>Sources & remarques</h2></header>
      <div class="controls">
        <div class="info">
          Les libell√©s sont synth√©tiques et destin√©s √† guider l‚Äô√©valuation. Utilisez la norme officielle pour les d√©finitions formelles.
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <div>¬© <span id="y"></span> Page d‚Äô√©valuation ISO/IEC 27001:2022 (Annexe A)</div>
      <div id="score"></div>
    </div>
  </footer>

  <script>
    // ====== Helpers ======
    const LS_PREFIX = 'iso27001-2022-ctrl-'; // localStorage key prefix

    function $(sel, ctx=document){ return ctx.querySelector(sel); }
    function $all(sel, ctx=document){ return [...ctx.querySelectorAll(sel)]; }

    // Ajoute Oui/Non √† chaque <li>
    function enhanceList(){
      $all('.controls li').forEach(li=>{
        if(li.dataset.enhanced) return;
        const ref = li.querySelector('.ref')?.textContent.trim() || '';
        const labelText = li.querySelector('.label')?.textContent.trim() || li.textContent.trim();
        const name = `ctrl-${ref}`;

        const yn = document.createElement('span');
        yn.className = 'yn';
        yn.innerHTML = `
          <label title="Oui"><input type="radio" name="${name}" value="oui"> Oui</label>
          <label title="Non"><input type="radio" name="${name}" value="non"> Non</label>
        `;
        li.appendChild(yn);

        // Restaurer √©tat
        const saved = localStorage.getItem(LS_PREFIX+ref);
        if(saved){
          const input = li.querySelector(\`input[value="\${saved}"]\`);
          if(input) input.checked = true;
        }

        // √âcouteur
        $all(\`input[name="\${name}"]\`, li).forEach(inp=>{
          inp.addEventListener('change', ()=>{
            localStorage.setItem(LS_PREFIX+ref, inp.value);
            updateStats();
          });
        });

        // Marqueur
        li.dataset.enhanced = '1';
        li.dataset.ref = ref;
        li.dataset.text = labelText;
      });
    }

    // Statistiques
    function computeStats(){
      const groups = { org: {yes:0,no:0,tot:37}, people:{yes:0,no:0,tot:8}, physical:{yes:0,no:0,tot:14}, tech:{yes:0,no:0,tot:34} };
      const details = []; // {ref, text, cat, val}
      const mapSecToCat = (sec)=> sec.closest('#org')?'org':sec.closest('#people')?'people':sec.closest('#physical')?'physical':'tech';

      $all('.controls').forEach(sec=>{
        const cat = mapSecToCat(sec);
        $all('li', sec).forEach(li=>{
          const ref = li.dataset.ref || '';
          const text = li.dataset.text || '';
          const val = li.querySelector('input:checked')?.value || 'na';
          if(val==='oui') groups[cat].yes++;
          else if(val==='non') groups[cat].no++;
          details.push({ref,text,cat,val});
        });
      });

      const sumYes = Object.values(groups).reduce((a,g)=>a+g.yes,0);
      const sumNo  = Object.values(groups).reduce((a,g)=>a+g.no,0);
      const total  = 93;
      const sumNA  = total - sumYes - sumNo;

      return {groups, details, global:{yes:sumYes,no:sumNo,na:sumNA,total}};
    }

    function updateStats(){
      const s = computeStats();
      // Global
      $('#g-yes').textContent = s.global.yes;
      $('#g-no').textContent  = s.global.no;
      $('#g-na').textContent  = s.global.na;
      // Cat√©gories (Oui seulement, indicatif)
      $('#o-yes').textContent  = s.groups.org.yes;
      $('#p-yes').textContent  = s.groups.people.yes;
      $('#ph-yes').textContent = s.groups.physical.yes;
      $('#t-yes').textContent  = s.groups.tech.yes;

      const pct = Math.round((s.global.yes / s.global.total) * 100);
      $('#score').textContent = `Conformit√© (Oui) : ${pct}% (${s.global.yes}/${s.global.total})`;
    }

    // Rapport HTML
    function generateReport(){
      const s = computeStats();
      const date = new Date().toLocaleString('fr-FR');
      const title = 'Rapport ‚Äî √âtat de conformit√© ISO/IEC 27001:2022 (Annexe A)';

      const by = (cat)=> s.details.filter(d=>d.cat===cat);
      const list = (arr, want)=> arr.filter(d=>d.val===want).sort((a,b)=> a.ref.localeCompare(b.ref));

      const cats = [
        {id:'org', label:'Organisationnels (5.x)'},
        {id:'people', label:'Personnes (6.x)'},
        {id:'physical', label:'Physiques (7.x)'},
        {id:'tech', label:'Technologiques (8.x)'},
      ];

      let html = `
<!doctype html><html lang="fr"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${title}</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px;line-height:1.55;color:#0f172a}
h1{font-size:22px;margin:0 0 6px} h2{margin:16px 0 8px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e40af;font-weight:700}
table{border-collapse:collapse;width:100%;margin:8px 0}
th,td{border:1px solid #e5e7eb;padding:8px;text-align:left;font-size:14px}
small{color:#64748b}
</style></head><body>
<h1>${title}</h1>
<div><small>G√©n√©r√© le ${date}</small></div>

<h2>R√©sum√© global</h2>
<table>
<tr><th>Total contr√¥les</th><th>Oui</th><th>Non</th><th>Non r√©pondu</th><th>Conformit√© (Oui)</th></tr>
<tr><td>93</td><td>${s.global.yes}</td><td>${s.global.no}</td><td>${s.global.na}</td><td>${Math.round((s.global.yes/93)*100)}%</td></tr>
</table>

<h2>D√©tail par cat√©gorie</h2>
<table>
<tr><th>Cat√©gorie</th><th>Oui</th><th>Non</th><th>Non r√©pondu</th><th>Total</th></tr>
<tr><td>Organisationnels (5.x)</td><td>${s.groups.org.yes}</td><td>${s.groups.org.no}</td><td>${37 - s.groups.org.yes - s.groups.org.no}</td><td>37</td></tr>
<tr><td>Personnes (6.x)</td><td>${s.groups.people.yes}</td><td>${s.groups.people.no}</td><td>${8  - s.groups.people.yes - s.groups.people.no}</td><td>8</td></tr>
<tr><td>Physiques (7.x)</td><td>${s.groups.physical.yes}</td><td>${s.groups.physical.no}</td><td>${14 - s.groups.physical.yes - s.groups.physical.no}</td><td>14</td></tr>
<tr><td>Technologiques (8.x)</td><td>${s.groups.tech.yes}</td><td>${s.groups.tech.no}</td><td>${34 - s.groups.tech.yes - s.groups.tech.no}</td><td>34</td></tr>
</table>

<h2>Contr√¥les ‚ÄúNon‚Äù (√† traiter en priorit√©)</h2>
`;

      cats.forEach(c=>{
        const arr = list(by(c.id), 'non');
        html += `<h3>${c.label} ‚Äî <span class="badge">${arr.length}</span></h3>`;
        if(arr.length===0){ html += '<div><small>Aucun contr√¥le marqu√© Non.</small></div>'; }
        else {
          html += '<table><tr><th>R√©f.</th><th>Intitul√© (synth√©tique)</th></tr>';
          arr.forEach(d=> html += `<tr><td>${d.ref}</td><td>${d.text}</td></tr>`);
          html += '</table>';
        }
      });

      html += `<h2>Contr√¥les ‚ÄúNon r√©pondu‚Äù (√† compl√©ter)</h2>`;
      cats.forEach(c=>{
        const arr = list(by(c.id), 'na');
        html += `<h3>${c.label} ‚Äî <span class="badge">${arr.length}</span></h3>`;
        if(arr.length===0){ html += '<div><small>Complet.</small></div>'; }
        else {
          html += '<table><tr><th>R√©f.</th><th>Intitul√© (synth√©tique)</th></tr>';
          arr.forEach(d=> html += `<tr><td>${d.ref}</td><td>${d.text}</td></tr>`);
          html += '</table>';
        }
      });

      html += '</body></html>';

      const win = window.open('', '_blank');
      win.document.write(html);
      win.document.close();
      win.focus();
    }

    // Export CSV
    function exportCSV(){
      const {details} = computeStats();
      const rows = [['Ref','Cat√©gorie','Intitul√©','R√©ponse']];
      const map = {org:'Organisationnel',people:'Personnes',physical:'Physique',tech:'Technologique'};
      details.forEach(d=> rows.push([d.ref, map[d.cat], d.text, d.val]));
      const csv = rows.map(r=> r.map(x=> `"${(x||'').replace(/"/g,'""')}"`).join(';')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'etat_iso27001_annexA.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // R√©initialisation
    function resetAll(){
      if(!confirm('Supprimer toutes les r√©ponses (Oui/Non) enregistr√©es ?')) return;
      $all('.controls li').forEach(li=>{
        const ref = li.dataset.ref;
        localStorage.removeItem(LS_PREFIX+ref);
        $all('input[type="radio"]', li).forEach(i=> i.checked=false);
      });
      updateStats();
    }

    // INIT
    (function init(){
      enhanceList();
      updateStats();
      $('#btn-report').addEventListener('click', generateReport);
      $('#btn-csv').addEventListener('click', exportCSV);
      $('#btn-reset').addEventListener('click', resetAll);
      $('#y').textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
